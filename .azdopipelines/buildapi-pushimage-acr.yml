# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger: none
#- master

pool:
  vmImage: ubuntu-latest
variables:
 resourceGroupName: "CONTAPP-APIM-DEV"
 location: "eastus"
 APP_NAME: "mydemos"
 APP_ENV: "dev"  
 imageName: "compliancewebapi"
 tag: "$(Build.BuildId)"
 registry: "$(APP_NAME)contregistry$(APP_ENV).azurecr.io"


steps:

- task: AzureCLI@2
  displayName: Build docker image for ComplianceWebApi and push to Azure container registry 
  inputs:
    azureSubscription: 'masterconnection'
    scriptType: 'bash'
    scriptLocation: 'scriptPath'
    scriptPath: 'src/WebApis/ComplianceWebApi/builddocker.sh'
  env:
      imageName: $(imageName)
      tag: $(tag)
      registry: $(registry) 

